{% extends "admin_panel/base.html" %}
{% load static %}

{% block title %}Task Management{% endblock %}
{% block page_title %}Task Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tasks.css' %}">
<link rel="stylesheet" href="{% static 'css/modal.css' %}">
{% endblock %}

{% block content %}
<div class="task-management-container">
    <div class="task-management-header">
        <h1>Task Management</h1>
        <div class="header-actions">
            {% comment %} <div class="search-box">
                <input type="text" id="taskSearchInput" placeholder="Search tasks...">
                <button id="taskSearchBtn"><i class="fas fa-search"></i></button>
            </div> {% endcomment %}
            <button class="add-btn" id="openAddTaskModalBtn">+ New Task</button>
        </div>
    </div>

    {% comment %} <div class="task-stats-flex">
        <!-- Total Users Card -->
        <div class="stat-card" id="totalUsersCard">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-value">Loading...</div> {# Will be populated by JS #}
            <div class="stat-label">Total Users</div>
        </div>

        <!-- Active Tasks Card -->
        <div class="stat-card" id="activeTasksCard">
            <div class="stat-icon"><i class="fas fa-tasks"></i></div>
            <div class="stat-value">Loading...</div> {# Will be populated by JS #}
            <div class="stat-label">Active Tasks</div>
        </div>
    </div> {% endcomment %}

    <div class="task-tabs">
        <button class="tab-link active" data-status="All">All Tasks (<span id="allTasksCount">0</span>)</button>
        <button class="tab-link" data-status="Pending">Pending (<span id="pendingTasksCount">0</span>)</button>
        <button class="tab-link" data-status="In Progress">In Progress (<span id="inProgressTasksCount">0</span>)</button>
        <button class="tab-link" data-status="Completed">Completed (<span id="completedTasksCount">0</span>)</button>
    </div>

    <div class="task-table-container">
        <table class="tasks-table">
            <thead>
                <tr>
                    <th>Task ID</th>
                    <th>Task Name</th>
                    <th>Assigned To</th>
                    <th>Project name</th>
                    <th>Workgroup</th>
                    <th>RTOM</th>
                    <th>Deadline</th>
                    <th>Attachment</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tasksTableBody">
                <!-- Task data will be populated by JS -->
            </tbody>
        </table>
    </div>

    <!-- Add Task Modal -->
    <div id="taskModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Task</h2>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm" class="modal-form">
                    <div class="form-group">
                        <label for="taskName">Task Name <span class="required">*</span></label>
                        <select id="taskName" name="taskName" required>
                            <option value="">Select Task</option>
                            <option value="SPECIFY DESIGN DETAILS">SPECIFY DESIGN DETAILS</option>
                            <option value="APPROVE PE">APPROVE PE</option>
                            <option value="SURVEY FIBER ROUTE">SURVEY FIBER ROUTE</option>
                            <option value="ASSIGN WORK">ASSIGN WORK</option>
                            <option value="DRAW FIBER">DRAW FIBER</option>
                            <option value="SPLICE & TERMINATE">SPLICE & TERMINATE</option>
                            <option value="UPLOAD FIBER_IN_OSS">UPLOAD FIBER_IN_OSS</option>
                            <option value="CONDUCT FIBER_PAT">CONDUCT FIBER_PAT</option>
                            <option value="UPLOAD DRAWING">UPLOAD DRAWING</option>
                            <option value="UPDATE MASTER DWG">UPDATE MASTER DWG</option>
                            <option value="CLOSE EVENT">CLOSE EVENT</option>
                        </select>
                </div>
                    <div class="form-group">
                        <label for="assignedTo">Assign To <span class="required">*</span></label>
                        <select id="assignedTo" name="assignedTo" required>
                        <option value="">Select Employee</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskProject">Project Name <span class="required">*</span></label>
                        <select id="taskProject" name="taskProject" required>
                            <option value="">Select Project</option>
                            {# Options will be populated by JavaScript #}
                    </select>
                </div>
                    <div class="form-group">
                        <label for="taskWorkgroup">Workgroup <span class="required">*</span></label>
                        <select id="taskWorkgroup" name="taskWorkgroup" required>
                        <option value="">Select Workgroup</option>
                            {# Options will be populated by JavaScript #}
                    </select>
                </div>
                    <div class="form-group">
                        <label for="taskRtom">RTOM <span class="required">*</span></label>
                        <select id="taskRtom" name="taskRtom" required>
                         <option value="">Select RTOM</option>
                            {# Options will be populated by JavaScript #}
                    </select>
                </div>
                    <div class="form-group">
                        <label for="taskDeadline">Deadline <span class="required">*</span></label>
                        <input type="date" id="taskDeadline" name="taskDeadline" required>
                </div>
                    <div class="form-group">
                        <label for="taskAttachment">Attachment (PDF/Other)</label>
                        <input type="file" id="taskAttachment" name="taskAttachment" accept=".pdf, image/*, .doc, .docx">
                    <small>Maximum file size: 5MB</small>
                </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Task</button>
                        <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                </div>
            </form>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="editModalTitle">Edit Task</h2>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editTaskForm" class="modal-form">
                    <input type="hidden" id="editTaskId" name="taskId">
                    <div class="form-group">
                        <label for="editTaskName">Task Name <span class="required">*</span></label>
                        <input type="text" id="editTaskName" name="taskName" required>
                    </div>
                    <div class="form-group">
                        <label for="editAssignedTo">Assign To <span class="required">*</span></label>
                        <select id="editAssignedTo" name="assignedTo" required>
                            <option value="">Select Employee</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskProject">Project Name <span class="required">*</span></label>
                        <select id="editTaskProject" name="taskProject" required>
                            <option value="">Select Project</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskWorkgroup">Workgroup <span class="required">*</span></label>
                        <select id="editTaskWorkgroup" name="taskWorkgroup" required>
                            <option value="">Select Workgroup</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskRtom">RTOM <span class="required">*</span></label>
                        <select id="editTaskRtom" name="taskRtom" required>
                            <option value="">Select RTOM</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskDeadline">Deadline <span class="required">*</span></label>
                        <input type="date" id="editTaskDeadline" name="taskDeadline" required>
                    </div>
                    <div class="form-group">
                        <label for="editTaskAttachment">Attachment (PDF/Other)</label>
                        <input type="file" id="editTaskAttachment" name="taskAttachment" accept=".pdf, image/*, .doc, .docx">
                        <small>Maximum file size: 5MB</small>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                </div>
            </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/tasks.js' %}" defer></script>
<script src="{% static 'js/modal.js' %}" defer></script>
{% endblock %}